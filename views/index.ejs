<!DOCTYPE html>
<html lang="en">
<head>
    <title>Weather</title>
    <!-- <link rel="stylesheet" href="../assets/style.css"> -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Caveat:wght@400;600&family=Cinzel:wght@600&family=Poppins:wght@300;400;500;800&display=swap');
*{
    margin:0px;
    border:0px;
    font-family: 'Poppins', sans-serif;
    background-color: aliceblue;
    
}
.container{
   display: flex;
   justify-content: center;
   flex-direction: column;
   align-items: center;
   height: 100vh;
   position: relative;  
}
.profile{
    position: absolute;
    top: 40px;
    left:60px;
}
.nav-bar{
    position: absolute;
    top:40px;
    right:65px;
}
nav .login-btn{
    color:black;
    font-size: 13px;
    padding:15px 20px; 
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
    border-radius: 25px;
    border:2px solid rgb(142, 139, 139);
}
nav .login-btn:hover{
    border:3px solid rgb(255, 50, 50);
}
.fav{
    position: absolute;
    top: 8%;
    left:20px;
}
#form{
    display: flex;
    justify-content: center;
    align-items: center;
}
.login{
    display: flex;
    justify-content: center;
    flex-direction: column;
    align-items: center;
}
.login-btn{
    width: 7rem;
    border-radius: 25px;
    cursor: pointer;
}
.login-btn:hover{
    border: 2px solid greenyellow;
}
.login-btn:active{
    box-shadow: 2px 2px 10px 2px rgb(95, 93, 93);
}

#btn{
    margin:0px;
    width: 6rem;
    padding:10px;
    height: 3.5rem;
    border-radius: 25px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
}
#btn:hover{
    border: 3px solid greenyellow;
    cursor: pointer;
    background-color: rgb(255, 255, 255);
}
#btn:active{
    box-shadow: 2px 2px 10px 2px rgb(95, 93, 93);
}
#loc{
    font-weight: 500;
    margin-top:10px;
    margin-bottom:0px;
    border: 0px;
    font-size: 35px;
}
h1{
    margin-top:50px;
    font-size:55px;
}
input{
    background: white;
    border: 2px solid rgb(142, 139, 139);
    margin: 25px;
    padding:15px 20px;
    width: 18rem;
    border-radius: 25px;
    font-size: 14px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
}
.weather, .image, .minValues, .maxValues, .imgClass{
    background-color: white;
}
.icons{
    background-color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
}
.forecast{
    display: flex;
}
.card{
    margin:40px;
    background-color: white;
    padding:30px;
    border-radius: 10px;
    box-shadow: rgba(0, 0, 0, 0.16) 0px 10px 36px 0px, rgba(0, 0, 0, 0.06) 0px 0px 0px 1px;
}
h3{
    background-color: white;
}
h2{
    margin-bottom:20px;
}
span{
    font-weight: 400;
    background-color: white;
}
img{
    width: 100px;
    height: 100px;
}
    </style>
</head>
<body>
    <div class="container">
        <h4 class="profile"><%=email%></h4>
        <input style="display:none" id="fav" type="text" value="<%=fav%>" readonly>
        <nav class="nav-bar">
            <a href="/logout" class="login-btn" style="text-decoration: none;">Logout</a>
        </nav>
        <h1> Weather </h1>
        <div class="card fav">
            <h2 class="weather">Favorite Place</h2>
            <h3 class="weather" id="fav-place">Loading...</h3>
            <p class="minValues" id="fav-temp">Loading...</p>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" version="1.0" width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000" preserveAspectRatio="xMidYMid meet">

            <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
            <path d="M1697 5007 c-21 -20 -38 -46 -42 -67 -6 -36 -1 -560 6 -594 3 -16 -8 -21 -86 -37 -49 -10 -118 -29 -152 -43 l-63 -25 0 30 c0 31 -243 463 -292 519 -69 79 -198 25 -198 -82 0 -41 242 -472 298 -530 20 -21 31 -38 25 -38 -15 0 -140 -117 -184 -172 l-37 -48 -19 25 c-15 19 -354 224 -480 289 -86 44 -183 -9 -183 -101 0 -60 28 -84 261 -218 264 -152 274 -157 304 -157 l23 0 -24 -60 c-19 -50 -31 -97 -60 -235 -4 -20 -6 -21 -32 -7 -36 18 -548 20 -602 1 -41 -14 -80 -68 -80 -109 0 -40 27 -83 64 -103 27 -14 69 -16 326 -13 162 2 303 7 313 12 14 7 17 3 17 -20 0 -41 35 -180 58 -235 l20 -47 -32 -5 c-39 -6 -492 -266 -525 -301 -27 -29 -37 -92 -19 -126 18 -33 75 -70 108 -70 30 0 486 256 532 298 15 14 30 39 34 56 5 28 22 41 159 119 l153 88 -40 79 c-56 110 -77 235 -60 351 28 192 151 359 327 445 278 135 591 43 765 -225 l16 -24 143 94 c122 79 145 90 155 77 18 -24 52 -38 93 -38 31 0 83 26 273 135 129 75 247 149 263 165 21 24 27 40 27 76 0 39 -5 51 -34 80 -28 28 -41 34 -77 34 -36 0 -76 -20 -278 -136 -130 -74 -248 -148 -263 -164 l-27 -29 -43 53 c-36 43 -67 73 -171 166 -4 3 7 23 25 42 18 20 92 139 163 264 113 199 130 234 129 271 -1 47 -20 75 -66 99 -44 23 -81 17 -121 -18 -42 -39 -296 -476 -304 -524 l-5 -31 -72 28 c-39 15 -108 33 -154 40 -68 11 -81 16 -75 29 5 8 8 152 8 320 0 289 -1 306 -20 332 -42 56 -117 63 -168 15z"/>
            <path d="M3230 3735 c-8 -2 -49 -9 -90 -15 -147 -24 -303 -86 -445 -178 -89 -57 -278 -248 -329 -333 l-40 -64 -150 0 c-123 0 -168 -5 -240 -23 -339 -85 -616 -348 -710 -674 l-24 -83 -43 -3 c-366 -21 -652 -254 -740 -601 -30 -119 -24 -310 14 -426 82 -249 265 -427 532 -516 l70 -24 1580 -3 c1141 -2 1602 0 1660 8 338 48 630 272 763 585 57 136 76 231 76 390 0 156 -17 242 -75 380 -85 205 -282 412 -476 499 -39 17 -41 21 -48 72 -21 168 -114 393 -223 540 -168 226 -419 386 -702 449 -68 15 -323 29 -360 20z m251 -400 c192 -33 358 -131 479 -282 136 -168 191 -365 166 -589 l-8 -72 74 -21 c136 -40 214 -72 269 -108 167 -113 263 -292 263 -493 0 -168 -61 -308 -184 -424 -79 -74 -162 -120 -266 -146 -75 -19 -116 -20 -1610 -20 -1511 0 -1533 0 -1598 20 -107 33 -187 103 -239 210 -29 60 -32 73 -32 165 0 92 3 106 32 167 60 126 181 212 317 225 60 5 86 1 261 -47 107 -30 196 -52 199 -49 2 2 -3 54 -10 114 -23 184 -19 272 14 368 63 183 194 313 382 378 51 17 87 22 170 22 96 0 117 -4 239 -42 73 -23 137 -39 142 -34 4 4 31 63 59 130 80 189 161 300 284 387 186 133 383 179 597 141z"/>
            </g>
            </svg>
        <form id="form">
            <input placeholder="Enter the city" type="text" name="city" id="city" autocomplete="off" autocapitalize="on" autofocus="on"/>
            <input type="submit" id="btn" value="Get">
        </form>
        <h1 id="loc" style="visibility: hidden">Location</h1>
        <div class="forecast" id="forecast" style="visibility: hidden">
            <div class="card">
                <div id="iconsContainer">
                    <div class="icons">
                        <h4 class="weather" id="day1"></h4>
                        <div class="image">
                            <img src="dots.png" class="imgClass" id="img1" alt="">
                        </div>
                        <p class="minValues" id="day1Min">...</p>
                        <p class="maxValues" id="day1Max">...</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <div id="iconsContainer">
                    <div class="icons">
                        <h4 class="weather" id="day2"></h4>
                        <div class="image">
                            <img src="dots.png" class="imgClass" id="img2">
                        </div>
                        <p class="minValues" id="day2Min">...</p>
                        <p class="maxValues" id="day2Max">...</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <div id="iconsContainer">
                    <div class="icons">
                        <h4 class="weather" id="day3"></h4>
                        <div class="image">
                            <img src="dots.png" class="imgClass" id="img3">
                        </div>
                        <p class="minValues" id="day3Min">...</p>
                        <p class="maxValues" id="day3Max">...</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <div id="iconsContainer">
                    <div class="icons">
                        <h4 class="weather" id="day4"></h4>
                        <div class="image">
                            <img src="dots.png" class="imgClass" id="img4">
                        </div>
                        <p class="minValues" id="day4Min">...</p>
                        <p class="maxValues" id="day4Max">...</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <div id="iconsContainer">
                    <div class="icons">
                        <h4 class="weather" id="day5"></h4>
                        <div class="image">
                            <img src="dots.png" class="imgClass" id="img5">
                        </div>
                        <p class="minValues" id="day5Min">...</p>
                        <p class="maxValues" id="day5Max">...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', ()=>{
  const apiKey = '4d7d0912d819bc8ea0e6661d1cc2b571';
    const city = document.getElementById('fav').value;
  const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`;  
  fetch(url)
      .then(res => res.json())
      .then(data => {
          document.getElementById('fav-place').innerHTML = data.name;
          document.getElementById('fav-temp').innerHTML = 'Temp : '+ data.main.temp;
          console.log(data)
      }).catch(error => console.log(error));
})

const form = document.querySelector('form')

form.addEventListener('submit', (e) => {
  e.preventDefault();
  const apiKey = '4d7d0912d819bc8ea0e6661d1cc2b571';
    const city = document.getElementById('city').value;
    const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}`;
    const forecast = document.getElementById("forecast")
    const loc = document.getElementById('loc')

    fetch(url)
        .then(res => res.json())
        .then(data => {
              for(i=0;i<5;i++){
                document.getElementById("day" +(i+1)+"Min").innerHTML = "Min : "+ Number(data.list[i].main.temp_min -273.15).toFixed(1)+" deg";
              }
              for(i=0;i<5;i++){
                document.getElementById("day" +(i+1)+"Max").innerHTML = "Max : "+ Number(data.list[i].main.temp_max -273.15).toFixed(1)+" deg";
              }
              for(i=0;i<5;i++){
                document.getElementById("img" +(i+1)).src = "http://openweathermap.org/img/wn/"+data.list[i].weather[0].icon+".png";
              }
              document.getElementById('loc').innerHTML = data.city.name;
              forecast.style.visibility = "visible";
              loc.style.visibility = "visible";
              Notification.requestPermission().then(permission => {
                if(permission === 'granted'){
                  new Notification("Weather Forecast",
                    {
                      body: `The current temperature in ${(data.city.name).toUpperCase()} is ${((data.list[0].main.temp_min) - 273.15).toFixed(1)+"Â°C"}`,
                      icon:"/images/cloud2.png"
                    }
                  )
                }
              })
            console.log(data)
        }).catch(error => console.log(error));
        document.getElementById('city').value = ""
        const d = new Date()
        const weekday = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']
        function checkDay(day){
            if(day + d.getDay > 7){
                return (day + d.getDay()) % 7;
            }else{
                return day + d.getDay();
            }
        }
        for(i=0;i<5;i++){
            document.getElementById("day"+(i+1)).innerHTML = weekday[checkDay(i)];
        }
})
    </script>
</body>
</html>